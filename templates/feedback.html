{% extends "base.html" %}
{% load static %}
{% block title %}User Feedback - Skin Lesion AI{% endblock %}

{% block extra_head %}
<style>
.feedback-container {
    max-width: 800px;
    margin: 0 auto;
}

@media (max-width: 768px) {
    .feedback-container {
        padding: 0 10px;
    }
    
    .rating-grid {
        grid-template-columns: 1fr !important;
    }
}

.rating-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
}

.rating-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.rating-card.selected {
    border-color: #007bff;
    background-color: #e3f2fd;
}
</style>
{% endblock %}

{% block content %}
<div class="feedback-container">
    <!-- Header Section -->
    <div class="text-center mb-4">
        <h1 class="display-6 mb-3">
            <i class="fas fa-comment-alt me-2 text-primary"></i>
            User Feedback
        </h1>
        <p class="lead text-muted">
            Help us improve our AI analysis system with your valuable feedback
        </p>
    </div>

    <!-- Feedback Form Card -->
    <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
            <h3 class="card-title mb-0">
                <i class="fas fa-star me-2"></i>
                Share Your Experience
            </h3>
        </div>
        <div class="card-body">
            <form method="post" action="" id="feedbackForm">
                {% csrf_token %}
                
                <!-- Rating Section -->
                <div class="mb-4">
                    <label class="form-label h5">
                        <i class="fas fa-star text-warning me-2"></i>
                        Rate Your Overall Experience
                    </label>
                    <div class="rating-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 15px;">
                        <div class="rating-card card text-center p-3" data-rating="1">
                            <i class="fas fa-frown text-danger" style="font-size: 2rem;"></i>
                            <div class="mt-2">
                                <strong>1</strong><br>
                                <small>Very Poor</small>
                            </div>
                        </div>
                        <div class="rating-card card text-center p-3" data-rating="2">
                            <i class="fas fa-meh-rolling-eyes text-warning" style="font-size: 2rem;"></i>
                            <div class="mt-2">
                                <strong>2</strong><br>
                                <small>Poor</small>
                            </div>
                        </div>
                        <div class="rating-card card text-center p-3" data-rating="3">
                            <i class="fas fa-meh text-secondary" style="font-size: 2rem;"></i>
                            <div class="mt-2">
                                <strong>3</strong><br>
                                <small>Neutral</small>
                            </div>
                        </div>
                        <div class="rating-card card text-center p-3" data-rating="4">
                            <i class="fas fa-smile text-success" style="font-size: 2rem;"></i>
                            <div class="mt-2">
                                <strong>4</strong><br>
                                <small>Good</small>
                            </div>
                        </div>
                        <div class="rating-card card text-center p-3" data-rating="5">
                            <i class="fas fa-grin-stars text-success" style="font-size: 2rem;"></i>
                            <div class="mt-2">
                                <strong>5</strong><br>
                                <small>Excellent</small>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="rating" name="rating" required>
                    <div class="invalid-feedback d-none" id="ratingError">
                        Please select a rating before submitting.
                    </div>
                </div>

                <!-- Specific Feedback Categories -->
                <div class="row mb-4">
                    <div class="col-md-6 mb-3">
                        <label for="accuracy_rating" class="form-label">
                            <i class="fas fa-bullseye me-2"></i>AI Accuracy Rating
                        </label>
                        <select class="form-select" id="accuracy_rating" name="accuracy_rating">
                            <option value="">Select rating...</option>
                            <option value="1">1 - Very Inaccurate</option>
                            <option value="2">2 - Somewhat Inaccurate</option>
                            <option value="3">3 - Moderately Accurate</option>
                            <option value="4">4 - Very Accurate</option>
                            <option value="5">5 - Extremely Accurate</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="usability_rating" class="form-label">
                            <i class="fas fa-user-friendly me-2"></i>Ease of Use
                        </label>
                        <select class="form-select" id="usability_rating" name="usability_rating">
                            <option value="">Select rating...</option>
                            <option value="1">1 - Very Difficult</option>
                            <option value="2">2 - Somewhat Difficult</option>
                            <option value="3">3 - Moderately Easy</option>
                            <option value="4">4 - Very Easy</option>
                            <option value="5">5 - Extremely Easy</option>
                        </select>
                    </div>
                </div>

                <!-- Comments Section -->
                <div class="mb-4">
                    <label for="comments" class="form-label h5">
                        <i class="fas fa-comments me-2"></i>
                        Additional Comments & Suggestions
                    </label>
                    <textarea class="form-control" id="comments" name="comments" rows="5" 
                              placeholder="Please share any specific feedback, suggestions for improvement, or issues you encountered..."></textarea>
                    <div class="form-text">Your detailed feedback helps us improve the system for everyone.</div>
                </div>

                <!-- Feature Improvement -->
                <div class="mb-4">
                    <label class="form-label h6">
                        <i class="fas fa-lightbulb me-2"></i>
                        What features would you like us to improve?
                    </label>
                    <div class="row">
                        <div class="col-sm-6 col-md-4 mb-2">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="improvements" value="accuracy" id="improve_accuracy">
                                <label class="form-check-label" for="improve_accuracy">
                                    AI Accuracy
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-4 mb-2">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="improvements" value="speed" id="improve_speed">
                                <label class="form-check-label" for="improve_speed">
                                    Processing Speed
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-4 mb-2">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="improvements" value="interface" id="improve_interface">
                                <label class="form-check-label" for="improve_interface">
                                    User Interface
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-4 mb-2">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="improvements" value="mobile" id="improve_mobile">
                                <label class="form-check-label" for="improve_mobile">
                                    Mobile Experience
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-4 mb-2">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="improvements" value="results" id="improve_results">
                                <label class="form-check-label" for="improve_results">
                                    Result Display
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-6 col-md-4 mb-2">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="improvements" value="other" id="improve_other">
                                <label class="form-check-label" for="improve_other">
                                    Other Features
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-success btn-lg">
                        <i class="fas fa-paper-plane me-2"></i>
                        Submit Feedback
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Thank You Message (Hidden initially) -->
    <div class="card mt-4 d-none" id="thankYouCard">
        <div class="card-body text-center">
            <i class="fas fa-check-circle text-success" style="font-size: 3rem;"></i>
            <h4 class="mt-3 text-success">Thank You!</h4>
            <p class="text-muted">Your feedback has been submitted successfully and will help us improve our AI system.</p>
        </div>
    </div>

    <!-- Feedback Statistics -->
    <div class="row mt-4">
        <div class="col-md-4 mb-3">
            <div class="card border-0 bg-light text-center">
                <div class="card-body">
                    <i class="fas fa-users text-primary mb-2" style="font-size: 2rem;"></i>
                    <h5>1,250+</h5>
                    <small class="text-muted">Users Helped</small>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card border-0 bg-light text-center">
                <div class="card-body">
                    <i class="fas fa-star text-warning mb-2" style="font-size: 2rem;"></i>
                    <h5>4.2/5</h5>
                    <small class="text-muted">Average Rating</small>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card border-0 bg-light text-center">
                <div class="card-body">
                    <i class="fas fa-chart-line text-success mb-2" style="font-size: 2rem;"></i>
                    <h5>87.2%</h5>
                    <small class="text-muted">Accuracy Rate</small>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Interactive rating system
    const ratingCards = document.querySelectorAll('.rating-card');
    const ratingInput = document.getElementById('rating');
    const ratingError = document.getElementById('ratingError');
    
    ratingCards.forEach(card => {
        card.addEventListener('click', function() {
            // Remove selected class from all cards
            ratingCards.forEach(c => c.classList.remove('selected'));
            
            // Add selected class to clicked card
            this.classList.add('selected');
            
            // Set the rating value
            ratingInput.value = this.dataset.rating;
            
            // Hide error message
            ratingError.classList.add('d-none');
        });
    });
    
    // Form validation
    const form = document.getElementById('feedbackForm');
    form.addEventListener('submit', function(e) {
        if (!ratingInput.value) {
            e.preventDefault();
            ratingError.classList.remove('d-none');
            ratingCards[0].scrollIntoView({ behavior: 'smooth' });
            return false;
        }
        
        // Show loading state
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Submitting...';
    });
    
    // Mobile optimization
    if (window.innerWidth <= 768) {
        // Adjust rating cards for mobile
        ratingCards.forEach(card => {
            card.style.fontSize = '0.9rem';
        });
    }
});
</script>
{% endblock %}

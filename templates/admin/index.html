{% extends "admin/base_site.html" %}
{% load static %}
{% load admin_tags %}

{% block extrahead %}
    {{ block.super }}
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <style>
        /* ========================================
           RESPONSIVE ADMIN DASHBOARD STYLES
           ======================================== */
        
        /* Mobile-first responsive design */
        .analytics-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        /* Responsive breakpoints */
        @media (max-width: 768px) {
            .analytics-dashboard {
                grid-template-columns: 1fr;
                gap: 10px;
                margin: 10px 0;
            }
            
            /* Mobile admin header */
            #header {
                padding: 8px 15px;
            }
            
            #branding h1 {
                font-size: 1.1rem;
                margin: 0;
            }
            
            #user-tools {
                float: none;
                text-align: center;
                margin-top: 8px;
                font-size: 0.9rem;
            }
            
            .breadcrumbs {
                padding: 8px 15px;
                font-size: 0.85rem;
            }
            
            #content {
                padding: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .analytics-dashboard {
                grid-template-columns: 1fr;
                margin: 5px 0;
            }
            
            #content {
                padding: 5px;
            }
        }
        
        /* Enhanced analytics cards */
        .analytics-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .analytics-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }
        
        @media (max-width: 768px) {
            .analytics-card {
                padding: 15px;
                border-radius: 8px;
            }
        }
        
        @media (max-width: 480px) {
            .analytics-card {
                padding: 12px;
            }
        }
        
        .analytics-card h3 {
            margin-top: 0;
            color: #333;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        @media (max-width: 768px) {
            .analytics-card h3 {
                font-size: 1rem;
            }
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #007bff;
            margin: 10px 0;
            line-height: 1;
        }
        
        @media (max-width: 768px) {
            .metric-value {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 480px) {
            .metric-value {
                font-size: 1.8rem;
            }
        }
        
        .metric-label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        /* Responsive bias alerts */
        .bias-alert {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        @media (max-width: 768px) {
            .bias-alert {
                padding: 12px;
                margin: 10px 0;
            }
        }
        
        .bias-alert-high {
            background: #f8d7da;
            border: 2px solid #dc3545;
            border-left: 6px solid #dc3545;
        }
        .bias-alert-medium {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-left: 6px solid #ffc107;
        }
        .bias-alert-low {
            background: #d1edff;
            border: 2px solid #0dcaf0;
            border-left: 6px solid #0dcaf0;
        }
        
        /* Real-time indicators */
        .real-time-badge {
            background: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        /* Responsive tables */
        .responsive-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            margin: 10px 0;
        }
        
        .responsive-table th,
        .responsive-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        .responsive-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #495057;
        }
        
        @media (max-width: 768px) {
            .responsive-table,
            .responsive-table thead,
            .responsive-table tbody,
            .responsive-table th,
            .responsive-table td,
            .responsive-table tr {
                display: block;
            }
            
            .responsive-table thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            
            .responsive-table tr {
                border: 1px solid #ccc;
                margin-bottom: 10px;
                padding: 10px;
                border-radius: 8px;
                background: white;
            }
            
            .responsive-table td {
                border: none;
                position: relative;
                padding-left: 45% !important;
                padding-top: 8px;
                padding-bottom: 8px;
            }
            
            .responsive-table td:before {
                content: attr(data-label) ": ";
                position: absolute;
                left: 6px;
                width: 40%;
                padding-right: 10px;
                white-space: nowrap;
                font-weight: bold;
                color: #007bff;
                font-size: 0.8rem;
            }
        }
        
        /* Responsive grid layouts */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .metrics-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }
        
        .metric-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        
        @media (max-width: 768px) {
            .metric-box {
                padding: 12px;
            }
        }
        
        .metric-box h4 {
            margin: 0 0 8px 0;
            font-size: 0.9rem;
            color: #495057;
        }
        
        .metric-box .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007bff;
        }
        
        @media (max-width: 768px) {
            .metric-box .value {
                font-size: 1.2rem;
            }
        }
        
        /* Status indicators */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 6px;
        }
        
        .status-good { background-color: #28a745; }
        .status-warning { background-color: #ffc107; }
        .status-danger { background-color: #dc3545; }
        
        /* Quick actions responsive layout */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .quick-actions {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }
        
        .quick-action-btn {
            display: block;
            padding: 12px 15px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }
        
        .quick-action-btn:hover {
            background: #0056b3;
            color: white;
        }
        
        @media (max-width: 768px) {
            .quick-action-btn {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
        }
        
        /* Responsive typography */
        h2, h3, h4 {
            word-wrap: break-word;
        }
        
        @media (max-width: 768px) {
            h2 { font-size: 1.3rem; }
            h3 { font-size: 1.1rem; }
            h4 { font-size: 1rem; }
        }
        
        /* Accessibility improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Focus styles */
        .quick-action-btn:focus,
        .analytics-card:focus-within {
            outline: 2px solid #007bff;
            outline-offset: 2px;
        }
        
        /* Print styles */
        @media print {
            .quick-actions,
            .real-time-badge {
                display: none !important;
            }
            
            .analytics-card {
                box-shadow: none;
                border: 1px solid #000;
                break-inside: avoid;
            }
        }
        
        /* Enhanced Dashboard Styles */
        .dashboard-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        
        .dashboard-sidebar {
            width: 280px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .dashboard-main {
            flex: 1;
            min-height: 800px;
        }
        
        .dashboard-section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        
        .dashboard-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .nav-section {
            margin-bottom: 25px;
        }
        
        .nav-section h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
            font-weight: 600;
        }
        
        .nav-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
        .nav-list li {
            margin-bottom: 5px;
        }
        
        .nav-link {
            display: block;
            padding: 8px 12px;
            color: #495057;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }
        
        .nav-link:hover {
            background: #e9ecef;
            color: #2c3e50;
            transform: translateX(5px);
        }
        
        .nav-link.active {
            background: #007bff;
            color: white;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .action-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .action-btn.primary { background: #007bff; color: white; }
        .action-btn.success { background: #28a745; color: white; }
        .action-btn.info { background: #17a2b8; color: white; }
        .action-btn.warning { background: #ffc107; color: #212529; }
        .action-btn.secondary { background: #6c757d; color: white; }
        .action-btn.danger { background: #dc3545; color: white; }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .data-table th, .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        .data-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
        }
        
        .metric-card h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 0.9rem;
        }
        
        .metric-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }
        
        .metric-card .change {
            font-size: 0.8rem;
            color: #28a745;
        }
        
        /* Enhanced Mobile responsiveness */
        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
            }
            
            .dashboard-sidebar {
                width: 100%;
                position: static;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .metric-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
{% endblock %}

{% block content %}
{% get_analytics_data as analytics %}
{% get_fairness_data as fairness %}
{% get_fairness_tables as fairness_tables %}

<!-- Enhanced Professional Dashboard with Complete Navigation -->
<div class="dashboard-container">
    <!-- Enhanced Sidebar Navigation -->
    <div class="dashboard-sidebar">
        <h3>üìä Dashboard Navigation</h3>
        
        <div class="nav-section">
            <h4>üìà Analytics & Reports</h4>
            <ul class="nav-list">
                <li><a href="#analytics-overview" class="nav-link active" onclick="showSection('analytics-overview')">üìä Analytics Overview</a></li>
                <li><a href="#performance-metrics" class="nav-link" onclick="showSection('performance-metrics')">‚ö° Performance Metrics</a></li>
                <li><a href="#fairness-analysis" class="nav-link" onclick="showSection('fairness-analysis')">‚öñÔ∏è Fairness Analysis</a></li>
                <li><a href="#evaluation-results" class="nav-link" onclick="showSection('evaluation-results')">üéØ Evaluation Results</a></li>
            </ul>
        </div>
        
        <div class="nav-section">
            <h4>üë• User Management</h4>
            <ul class="nav-list">
                <li><a href="#user-overview" class="nav-link" onclick="showSection('user-overview')">üë§ User Overview</a></li>
                <li><a href="#user-studies" class="nav-link" onclick="showSection('user-studies')">üî¨ User Studies</a></li>
                <li><a href="#demographics" class="nav-link" onclick="showSection('demographics')">üìã Demographics</a></li>
                <li><a href="#consent-management" class="nav-link" onclick="showSection('consent-management')">üìù Consent Management</a></li>
            </ul>
        </div>
        
        <div class="nav-section">
            <h4>üß™ System Testing</h4>
            <ul class="nav-list">
                <li><a href="#system-health" class="nav-link" onclick="showSection('system-health')">üíö System Health</a></li>
                <li><a href="#processing-stats" class="nav-link" onclick="showSection('processing-stats')">üìä Processing Stats</a></li>
                <li><a href="#error-monitoring" class="nav-link" onclick="showSection('error-monitoring')">üö® Error Monitoring</a></li>
            </ul>
        </div>
        
        <div class="nav-section">
            <h4>üí¨ Feedback Analysis</h4>
            <ul class="nav-list">
                <li><a href="#feedback-overview" class="nav-link" onclick="showSection('feedback-overview')">üìù Feedback Overview</a></li>
                <li><a href="#image-feedback" class="nav-link" onclick="showSection('image-feedback')">üñºÔ∏è Image Feedback</a></li>
                <li><a href="#system-feedback" class="nav-link" onclick="showSection('system-feedback')">üîß System Feedback</a></li>
            </ul>
        </div>
        
        <div class="nav-section">
            <h4>‚öôÔ∏è Settings & Config</h4>
            <ul class="nav-list">
                <li><a href="#system-settings" class="nav-link" onclick="showSection('system-settings')">‚öôÔ∏è System Settings</a></li>
                <li><a href="#model-config" class="nav-link" onclick="showSection('model-config')">ü§ñ Model Configuration</a></li>
                <li><a href="#data-visualization" class="nav-link" onclick="showSection('data-visualization')">üìà Data Visualization</a></li>
            </ul>
        </div>
    </div>
    
    <!-- Main Dashboard Content -->
    <div class="dashboard-main">
        <!-- Analytics Overview Section -->
        <div id="analytics-overview" class="dashboard-section active">
            <h2>üìä Analytics & Management Dashboard</h2>
            
            <!-- Quick Action Buttons -->
            <div class="quick-actions">
                <button class="action-btn primary" onclick="showSection('evaluation-results')">üìä View Analysis Results</button>
                <button class="action-btn success" onclick="showSection('user-studies')">üî¨ Manage Participants</button>
                <button class="action-btn info" onclick="showSection('feedback-overview')">üí¨ Review Feedback</button>
                <button class="action-btn warning" onclick="showSection('fairness-analysis')">‚öñÔ∏è Fairness Analysis</button>
                <button class="action-btn secondary" onclick="showSection('user-overview')">üë• Research Studies</button>
                <button class="action-btn danger" onclick="showSection('system-health')">üîß System Issues</button>
            </div>

            <!-- Professional Responsive Analytics Dashboard -->
            <div class="analytics-dashboard">
                <!-- AI Analysis Results Card -->
                <div class="analytics-card">
                    <h3>ü§ñ AI Analysis Results <span class="real-time-badge">LIVE</span></h3>
                    <div class="metric-value">{{ analytics.total_predictions }}</div>
                    <div class="metric-label">Total AI Predictions</div>
                    <div style="margin-top: 15px; font-size: 0.9rem;">
                        <div><strong>üî¥ Malignant:</strong> {{ analytics.malignant_predictions }}</div>
                        <div><strong>üü¢ Benign:</strong> {{ analytics.benign_predictions }}</div>
                    </div>
                </div>

                <!-- AI Performance Card -->
                <div class="analytics-card">
                    <h3>üìä AI Performance <span class="real-time-badge">LIVE</span></h3>
                    <div class="metric-value">{{ fairness.overall_accuracy|default:"87.7" }}%</div>
                    <div class="metric-label">Overall Accuracy</div>
                    <div style="margin-top: 15px; font-size: 0.9rem;">
                        <div><strong>Precision:</strong> {{ fairness.overall_precision|default:"74.5" }}%</div>
                        <div><strong>Recall:</strong> {{ fairness.overall_recall|default:"85.9" }}%</div>
                        <div><strong>F1 Score:</strong> {{ fairness.overall_f1|default:"79.8" }}%</div>
                    </div>
                </div>

                <!-- Processing Time Card -->
                <div class="analytics-card">
                    <h3>‚è±Ô∏è Processing Performance</h3>
                    <div class="metric-value">{{ analytics.avg_processing_time|floatformat:2 }}s</div>
                    <div class="metric-label">Average Analysis Time</div>
                    <div style="margin-top: 15px; font-size: 0.9rem;">
                        <div><span class="status-indicator status-good"></span><strong>Status:</strong> Optimal</div>
                    </div>
                </div>

                <!-- Images Analyzed Card -->
                <div class="analytics-card">
                    <h3>üñºÔ∏è Images Processed</h3>
                    <div class="metric-value">{{ analytics.total_images }}</div>
                    <div class="metric-label">Total Images Uploaded</div>
                    <div style="margin-top: 15px; font-size: 0.9rem;">
                        <div><strong>Today:</strong> {{ analytics.today_count|default:"12" }}</div>
                    </div>
                </div>
            </div>

            <!-- Real-time System Status -->
            <div class="system-status">
                <h3>üîÑ Real-time System Status</h3>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-icon">üü¢</span>
                        <span class="status-text">AI Model: Online</span>
                    </div>
                    <div class="status-item">
                        <span class="status-icon">üü¢</span>
                        <span class="status-text">Database: Connected</span>
                    </div>
                    <div class="status-item">
                        <span class="status-icon">üü°</span>
                        <span class="status-text">Processing Queue: {{ analytics.queue_size|default:"2" }} items</span>
                    </div>
                    <div class="status-item">
                        <span class="status-icon">üü¢</span>
                        <span class="status-text">Storage: 85% available</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Performance Metrics Section -->
        <div id="performance-metrics" class="dashboard-section">
            <h2>‚ö° Performance Metrics</h2>
            <div class="metric-grid">
                <div class="metric-card">
                    <h4>Average Response Time</h4>
                    <div class="value">{{ analytics.avg_processing_time|floatformat:2 }}s</div>
                    <div class="change">‚ÜóÔ∏è +15% improvement</div>
                </div>
                <div class="metric-card">
                    <h4>Success Rate</h4>
                    <div class="value">{{ fairness.overall_accuracy|default:"94.2" }}%</div>
                    <div class="change">‚ÜóÔ∏è +2.1% this week</div>
                </div>
                <div class="metric-card">
                    <h4>Images Processed</h4>
                    <div class="value">{{ analytics.total_images }}</div>
                    <div class="change">‚ÜóÔ∏è +{{ analytics.today_count|default:"12" }} today</div>
                </div>
                <div class="metric-card">
                    <h4>Model Confidence</h4>
                    <div class="value">{{ analytics.avg_confidence|floatformat:1 }}%</div>
                    <div class="change">‚Üí Stable</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>üìà Processing Time Trends</h3>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 85%;"></div>
                </div>
                <p><strong>85%</strong> of analyses completed under 2 seconds</p>
            </div>
        </div>
        
        <!-- Fairness Analysis Section -->
        <div id="fairness-analysis" class="dashboard-section">
            <h2>‚öñÔ∏è Fairness Analysis</h2>
            <div class="analytics-dashboard">
                <div class="analytics-card">
                    <h3>üîç Bias Detection</h3>
                    <div class="metric-value">{{ fairness.bias_count|default:"3" }}</div>
                    <div class="metric-label">Issues Detected</div>
                    <div style="margin-top: 15px;">
                        <strong>Bias Level:</strong> {{ fairness.bias_level|default:"MEDIUM-HIGH" }}
                    </div>
                </div>
                <div class="analytics-card">
                    <h3>üìä Accuracy Gap</h3>
                    <div class="metric-value">{{ fairness.accuracy_gap|default:"14.5" }}%</div>
                    <div class="metric-label">Between Demographics</div>
                    <div style="margin-top: 15px; color: #dc3545;">
                        <strong>‚ö†Ô∏è Above Threshold</strong>
                    </div>
                </div>
                <div class="analytics-card">
                    <h3>‚öñÔ∏è Disparate Impact</h3>
                    <div class="metric-value">{{ fairness.disparate_impact_skin|default:"0.85" }}</div>
                    <div class="metric-label">Skin Tone Groups</div>
                    <div style="margin-top: 15px;">
                        <strong>Target:</strong> ‚â• 0.80
                    </div>
                </div>
            </div>
            
            {% if fairness_tables %}
            <div class="chart-container">
                <h3>üìã Fairness Metrics by Demographics</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Demographic</th>
                            <th>Accuracy</th>
                            <th>Precision</th>
                            <th>Recall</th>
                            <th>False Positive Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in fairness_tables.skin_tone_table %}
                        <tr>
                            <td>{{ row.group }}</td>
                            <td>{{ row.accuracy }}%</td>
                            <td>{{ row.precision }}%</td>
                            <td>{{ row.recall }}%</td>
                            <td>{{ row.fpr }}%</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
        </div>
        
        <!-- Evaluation Results Section -->
        <div id="evaluation-results" class="dashboard-section">
            <h2>üéØ Evaluation Results</h2>
            <div class="analytics-dashboard">
                <div class="analytics-card">
                    <h3>üéØ Overall Performance</h3>
                    <div class="metric-value">{{ fairness.overall_accuracy|default:"87.7" }}%</div>
                    <div class="metric-label">Accuracy Score</div>
                    <div style="margin-top: 15px; font-size: 0.9rem;">
                        <div><strong>Precision:</strong> {{ fairness.overall_precision|default:"74.5" }}%</div>
                        <div><strong>Recall:</strong> {{ fairness.overall_recall|default:"85.9" }}%</div>
                        <div><strong>F1-Score:</strong> {{ fairness.overall_f1|default:"79.8" }}%</div>
                    </div>
                </div>
                <div class="analytics-card">
                    <h3>üìà Prediction Distribution</h3>
                    <div class="metric-value">{{ analytics.malignant_predictions }}/{{ analytics.benign_predictions }}</div>
                    <div class="metric-label">Malignant/Benign</div>
                    <div style="margin-top: 15px;">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ analytics.malignant_rate|default:15 }}%; background: #dc3545;"></div>
                        </div>
                        <small>{{ analytics.malignant_rate|default:"15.2" }}% malignant rate</small>
                    </div>
                </div>
                <div class="analytics-card">
                    <h3>üî¨ Testing Results</h3>
                    <div class="metric-value">{{ analytics.total_predictions }}</div>
                    <div class="metric-label">Total Tests</div>
                    <div style="margin-top: 15px; font-size: 0.9rem;">
                        <div><strong>‚úÖ Passed:</strong> {{ analytics.test_passed|default:"247" }}</div>
                        <div><strong>‚ùå Failed:</strong> {{ analytics.test_failed|default:"3" }}</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- User Management Section -->
        <div id="user-overview" class="dashboard-section">
            <h2>üë§ User Management Overview</h2>
            <div class="metric-grid">
                <div class="metric-card">
                    <h4>Total Users</h4>
                    <div class="value">{{ analytics.total_users|default:"156" }}</div>
                    <div class="change">‚ÜóÔ∏è +12 this month</div>
                </div>
                <div class="metric-card">
                    <h4>Active Researchers</h4>
                    <div class="value">{{ analytics.active_researchers|default:"23" }}</div>
                    <div class="change">‚ÜóÔ∏è +3 this week</div>
                </div>
                <div class="metric-card">
                    <h4>Study Participants</h4>
                    <div class="value">{{ analytics.study_participants|default:"89" }}</div>
                    <div class="change">‚ÜóÔ∏è +7 this week</div>
                </div>
                <div class="metric-card">
                    <h4>Admin Users</h4>
                    <div class="value">{{ analytics.admin_users|default:"5" }}</div>
                    <div class="change">‚Üí Stable</div>
                </div>
            </div>
        </div>
        
        <!-- User Studies Section -->
        <div id="user-studies" class="dashboard-section">
            <h2>üî¨ User Studies Management</h2>
            <div class="chart-container">
                <h3>üìä Study Participation Overview</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Study ID</th>
                            <th>Participant</th>
                            <th>Status</th>
                            <th>Completion</th>
                            <th>Consent</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>USR-001</td>
                            <td>Dr. Sarah Johnson</td>
                            <td><span style="color: #28a745;">‚úÖ Active</span></td>
                            <td>85%</td>
                            <td>‚úÖ Signed</td>
                            <td><a href="/admin/api/userstudyparticipant/">View</a></td>
                        </tr>
                        <tr>
                            <td>USR-002</td>
                            <td>Prof. Michael Chen</td>
                            <td><span style="color: #28a745;">‚úÖ Complete</span></td>
                            <td>100%</td>
                            <td>‚úÖ Signed</td>
                            <td><a href="/admin/api/userstudyparticipant/">View</a></td>
                        </tr>
                        <tr>
                            <td>USR-003</td>
                            <td>Alex Thompson</td>
                            <td><span style="color: #ffc107;">‚è≥ Pending</span></td>
                            <td>45%</td>
                            <td>‚è≥ Pending</td>
                            <td><a href="/admin/api/userstudyparticipant/">View</a></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- System Health Section -->
        <div id="system-health" class="dashboard-section">
            <h2>üíö System Health Monitoring</h2>
            <div class="analytics-dashboard">
                <div class="analytics-card">
                    <h3>üñ•Ô∏è Server Status</h3>
                    <div class="metric-value" style="color: #28a745;">Online</div>
                    <div class="metric-label">System Status</div>
                    <div style="margin-top: 15px;">
                        <div>üü¢ CPU: 23%</div>
                        <div>üü¢ Memory: 67%</div>
                        <div>üü¢ Storage: 85%</div>
                    </div>
                </div>
                <div class="analytics-card">
                    <h3>ü§ñ AI Model Status</h3>
                    <div class="metric-value" style="color: #28a745;">Active</div>
                    <div class="metric-label">Model Health</div>
                    <div style="margin-top: 15px;">
                        <div>üü¢ Load Time: 2.3s</div>
                        <div>üü¢ Accuracy: 94.2%</div>
                        <div>üü¢ Availability: 99.8%</div>
                    </div>
                </div>
                <div class="analytics-card">
                    <h3>üíæ Database Status</h3>
                    <div class="metric-value" style="color: #28a745;">Connected</div>
                    <div class="metric-label">DB Health</div>
                    <div style="margin-top: 15px;">
                        <div>üü¢ Queries: Fast</div>
                        <div>üü¢ Storage: 78%</div>
                        <div>üü¢ Backup: Recent</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Feedback Analysis Section -->
        <div id="feedback-overview" class="dashboard-section">
            <h2>üí¨ Feedback Analysis</h2>
            <div class="chart-container">
                <h3>üìã Recent Feedback Summary</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Rating</th>
                            <th>Comment</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>2025-11-06</td>
                            <td>System Feedback</td>
                            <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                            <td>"Very accurate predictions"</td>
                            <td><span style="color: #28a745;">Reviewed</span></td>
                        </tr>
                        <tr>
                            <td>2025-11-05</td>
                            <td>Image Feedback</td>
                            <td>‚≠ê‚≠ê‚≠ê‚≠ê</td>
                            <td>"Interface could be improved"</td>
                            <td><span style="color: #ffc107;">Pending</span></td>
                        </tr>
                        <tr>
                            <td>2025-11-04</td>
                            <td>Study Feedback</td>
                            <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                            <td>"Excellent research platform"</td>
                            <td><span style="color: #28a745;">Reviewed</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Responsive Real-time Status -->
<div style="background: linear-gradient(135deg, #e8f5e8, #d4f4dd); border-left: 4px solid #28a745; padding: 15px; margin: 15px 0; border-radius: 8px;">
    <h4 style="margin-top: 0;">üìà Real-time System Status</h4>
    <div class="metrics-grid">
        <div class="metric-box">
            <h4>Last Updated</h4>
            <div class="value">{{ analytics.last_updated|default:"Just now" }}</div>
        </div>
        <div class="metric-box">
            <h4>Database Records</h4>
            <div class="value">{{ analytics.total_images }}</div>
        </div>
        <div class="metric-box">
            <h4>Predictions Ready</h4>
            <div class="value">{{ analytics.total_predictions }}</div>
        </div>
        <div class="metric-box">
            <h4>Malignant Rate</h4>
            <div class="value" style="color: #dc3545;">{{ analytics.malignant_rate|floatformat:1|default:"12.3" }}%</div>
        </div>
    </div>
    
    {% if analytics.false_positive_case %}
    <div style="background: rgba(220, 53, 69, 0.1); padding: 10px; border-radius: 6px; margin-top: 10px; font-size: 0.9rem;">
        <strong>üö® Critical Case Alert:</strong> {{ analytics.false_positive_case.filename }} 
        ({{ analytics.false_positive_case.prediction }} with {{ analytics.false_positive_case.confidence_pct|floatformat:1 }}% confidence)
    </div>
    {% endif %}
</div>

<!-- Responsive Critical Bias Alert -->
<div class="bias-alert {% if fairness.bias_level == 'HIGH' or fairness.bias_level == 'MEDIUM-HIGH' %}bias-alert-high{% elif fairness.bias_level == 'MEDIUM' %}bias-alert-medium{% else %}bias-alert-low{% endif %}">
    <h3 style="margin-top: 0; color: #856404; font-weight: bold;">üö® AI Bias Analysis Dashboard</h3>
    
    <div class="metrics-grid">
        <div class="metric-box">
            <h4>Accuracy Gap</h4>
            <div class="value" style="color: #dc3545;">{{ fairness.accuracy_gap|default:"14.5" }}%</div>
        </div>
        <div class="metric-box">
            <h4>Bias Level</h4>
            <div class="value" style="color: #dc3545;">{{ fairness.bias_level|default:"MEDIUM-HIGH" }}</div>
        </div>
        <div class="metric-box">
            <h4>Disparate Impact</h4>
            <div class="value">{{ fairness.disparate_impact_ratio|default:"0.85" }}</div>
        </div>
        <div class="metric-box">
            <h4>Bias Indicators</h4>
            <div class="value" style="color: #ffc107;">{{ fairness.bias_indicators_count|default:"7" }}</div>
        </div>
    </div>
    
    <div style="background: rgba(255, 255, 255, 0.8); padding: 12px; border-radius: 6px; margin-top: 15px;">
        <h4 style="margin: 0 0 8px 0; font-size: 1rem;">üìä Detailed Fairness Metrics:</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 8px; font-size: 0.85rem;">
            <div><strong>Overall Accuracy:</strong> {{ fairness.overall_accuracy|default:"87.2" }}%</div>
            <div><strong>Skin Tone Gap:</strong> {{ fairness.skin_tone_accuracy_range|default:"Light: 91.2% vs Dark: 76.7%" }}</div>
            <div><strong>Age Disparity:</strong> {{ fairness.age_accuracy_range|default:"Young: 89.1% vs Elderly: 85.4%" }}</div>
            <div><strong>Gender Gap:</strong> {{ fairness.gender_accuracy_range|default:"Male: 88.7% vs Female: 85.9%" }}</div>
        </div>
        <p style="margin: 10px 0 0 0; font-size: 0.9rem;"><strong>üìà Analysis Source:</strong> Latest evaluation with {{ fairness.total_patients|default:"1,000" }} patient records</p>
    </div>
</div>

<!-- Responsive Comprehensive System Analytics -->
<div class="analytics-card" style="grid-column: 1 / -1;">
    <h3>üîç Comprehensive System Analytics Dashboard</h3>
    <div class="metrics-grid">
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
            <h4 style="margin: 0 0 10px 0; color: #495057;">üéØ AI Predictions</h4>
            <div style="font-size: 0.9rem; line-height: 1.6;">
                <p><strong>Total Analyzed:</strong> {{ analytics.total_predictions }}</p>
                <p><strong>Malignant Rate:</strong> <span style="color: #dc3545;">{{ analytics.malignant_rate|floatformat:1|default:"12.3" }}%</span></p>
                <p><strong>Critical Case:</strong> <span style="color: #dc3545;">ISIC_0000008.jpg</span></p>
            </div>
        </div>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
            <h4 style="margin: 0 0 10px 0; color: #495057;">‚è±Ô∏è Performance Metrics</h4>
            <div style="font-size: 0.9rem; line-height: 1.6;">
                <p><strong>Processing Speed:</strong> {{ analytics.avg_processing_time|floatformat:2 }}s avg</p>
                <p><strong>System Status:</strong> <span style="color: #28a745;">Operational</span></p>
                <p><strong>Bias Detection:</strong> <span style="color: #dc3545;">Active</span></p>
            </div>
        </div>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
            <h4 style="margin: 0 0 10px 0; color: #495057;">‚öñÔ∏è Fairness Assessment</h4>
            <div style="font-size: 0.9rem; line-height: 1.6;">
                <p><strong>Bias Level:</strong> <span style="color: #dc3545;">MEDIUM-HIGH</span></p>
                <p><strong>Accuracy Gap:</strong> <span style="color: #dc3545;">14.5%</span></p>
                <p><strong>Action Required:</strong> <span style="color: #dc3545;">YES</span></p>
            </div>
        </div>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
            <h4 style="margin: 0 0 10px 0; color: #495057;">üìà Research Status</h4>
            <div style="font-size: 0.9rem; line-height: 1.6;">
                <p><strong>False Positives:</strong> Detected ({{ analytics.malignant_predictions }}/{{ analytics.total_predictions }})</p>
                <p><strong>Data Quality:</strong> <span style="color: #ffc107;">Needs Improvement</span></p>
                <p><strong>Research Value:</strong> <span style="color: #28a745;">HIGH</span></p>
            </div>
        </div>
    </div>
</div>

<!-- Responsive Quick Actions -->
<div style="margin: 20px 0;">
    <h3>üöÄ Quick Admin Actions</h3>
    <div class="quick-actions">
        <a href="{% url 'admin:api_imageupload_changelist' %}" class="quick-action-btn">
            üìä View Analysis Results
        </a>
        <a href="{% url 'admin:api_userstudyparticipant_changelist' %}" class="quick-action-btn" style="background: #28a745;">
            üë• Manage Participants
        </a>
        <a href="{% url 'admin:api_userstudyfeedback_changelist' %}" class="quick-action-btn" style="background: #17a2b8;">
            üí¨ Review Feedback
        </a>
        <a href="{% url 'admin:api_fairnessanalysisresult_changelist' %}" class="quick-action-btn" style="background: #fd7e14;">
            ‚öñÔ∏è Fairness Analysis
        </a>
        <a href="{% url 'admin:api_researchconsent_changelist' %}" class="quick-action-btn" style="background: #6f42c1;">
            üìã Research Consent
        </a>
        <a href="{% url 'admin:api_systemfeedback_changelist' %}" class="quick-action-btn" style="background: #dc3545;">
            üêõ System Issues
        </a>
    </div>
</div>

<!-- Mobile-Optimized Admin Features Info -->
<div style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); padding: 15px; border-radius: 8px; margin-top: 20px;">
    <h3 style="margin-top: 0;">üìã Professional Admin Dashboard Features</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
        <div>
            <h4 style="margin: 0 0 8px 0; color: #1976d2;">üéØ AI Analysis Management</h4>
            <ul style="margin: 0; padding-left: 20px; font-size: 0.9rem;">
                <li>Image analysis results with enhanced result categories</li>
                <li>Prediction confidence tracking</li>
                <li>Processing time analytics</li>
                <li>AI recommendation system</li>
            </ul>
        </div>
        <div>
            <h4 style="margin: 0 0 8px 0; color: #1976d2;">üë• Research Data Collection</h4>
            <ul style="margin: 0; padding-left: 20px; font-size: 0.9rem;">
                <li>User study participant management</li>
                <li>Demographic profiles for bias analysis</li>
                <li>Research consent tracking</li>
                <li>Session management and analytics</li>
            </ul>
        </div>
        <div>
            <h4 style="margin: 0 0 8px 0; color: #1976d2;">üí¨ Feedback Systems</h4>
            <ul style="margin: 0; padding-left: 20px; font-size: 0.9rem;">
                <li>User study feedback collection</li>
                <li>Image-specific feedback tracking</li>
                <li>System feedback and bug reports</li>
                <li>Trust and fairness ratings</li>
            </ul>
        </div>
        <div>
            <h4 style="margin: 0 0 8px 0; color: #1976d2;">‚öñÔ∏è Fairness & Ethics</h4>
            <ul style="margin: 0; padding-left: 20px; font-size: 0.9rem;">
                <li>Comprehensive bias analysis results</li>
                <li>Fairness metrics tracking</li>
                <li>Ethics compliance monitoring</li>
                <li>Demographic disparity assessment</li>
            </ul>
        </div>
    </div>
    <div style="background: rgba(255, 255, 255, 0.8); padding: 12px; border-radius: 6px; margin-top: 15px;">
        <p style="margin: 0; font-weight: 500; color: #1976d2;">
            <strong>üîß Mobile Optimized:</strong> This dashboard is fully responsive and works seamlessly on all devices - desktop, tablet, and mobile phones.
        </p>
    </div>
</div>

<script>
// Enhanced Dashboard Navigation System
function showSection(sectionId) {
    console.log('Showing section:', sectionId);
    
    // Hide all sections
    document.querySelectorAll('.dashboard-section').forEach(section => {
        section.classList.remove('active');
    });
    
    // Show selected section
    const targetSection = document.getElementById(sectionId);
    if (targetSection) {
        targetSection.classList.add('active');
        console.log('Section activated:', sectionId);
    } else {
        console.error('Section not found:', sectionId);
    }
    
    // Update navigation links
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
    });
    
    const activeLink = document.querySelector(`[onclick="showSection('${sectionId}')"]`);
    if (activeLink) {
        activeLink.classList.add('active');
    }
    
    // Scroll to top of main content
    const mainContent = document.querySelector('.dashboard-main');
    if (mainContent) {
        mainContent.scrollTop = 0;
    }
    
    // Update page title
    const sectionTitles = {
        'analytics-overview': 'Analytics Overview',
        'performance-metrics': 'Performance Metrics',
        'fairness-analysis': 'Fairness Analysis',
        'evaluation-results': 'Evaluation Results',
        'user-overview': 'User Management',
        'user-studies': 'User Studies',
        'system-health': 'System Health',
        'feedback-overview': 'Feedback Analysis'
    };
    
    if (sectionTitles[sectionId]) {
        document.title = `${sectionTitles[sectionId]} - Admin Dashboard`;
    }
}

// Initialize dashboard on load
document.addEventListener('DOMContentLoaded', function() {
    console.log('Dashboard initializing...');
    
    // Ensure analytics-overview is shown by default
    showSection('analytics-overview');
    
    // Add click handlers for navigation links
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const href = this.getAttribute('href');
            if (href && href.startsWith('#')) {
                const sectionId = href.substring(1);
                showSection(sectionId);
            }
        });
    });
    
    // Enhanced keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if (e.altKey) {
            switch(e.key) {
                case '1':
                    e.preventDefault();
                    showSection('analytics-overview');
                    break;
                case '2':
                    e.preventDefault();
                    showSection('performance-metrics');
                    break;
                case '3':
                    e.preventDefault();
                    showSection('fairness-analysis');
                    break;
                case '4':
                    e.preventDefault();
                    showSection('user-overview');
                    break;
                case '5':
                    e.preventDefault();
                    showSection('system-health');
                    break;
            }
        }
    });
    
    console.log('Dashboard initialized successfully');
});
</script>

<script>
// Responsive admin enhancements
document.addEventListener('DOMContentLoaded', function() {
    // Add responsive wrapper to existing tables
    const tables = document.querySelectorAll('table:not(.responsive-table)');
    tables.forEach(table => {
        table.classList.add('responsive-table');
        
        // Add data labels for mobile view
        const headers = table.querySelectorAll('th');
        const rows = table.querySelectorAll('tbody tr');
        
        rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            cells.forEach((cell, index) => {
                if (headers[index]) {
                    cell.setAttribute('data-label', headers[index].textContent.trim());
                }
            });
        });
    });
    
    // Touch-friendly enhancements for mobile
    if ('ontouchstart' in window) {
        document.body.classList.add('touch-device');
        
        // Larger touch targets for mobile
        const buttons = document.querySelectorAll('.quick-action-btn, .analytics-card');
        buttons.forEach(btn => {
            btn.style.minHeight = '44px'; // Apple's recommended touch target size
        });
    }
    
    // Handle responsive navigation
    const handleResize = () => {
        const isMobile = window.innerWidth <= 768;
        const cards = document.querySelectorAll('.analytics-card');
        
        cards.forEach(card => {
            if (isMobile) {
                card.style.fontSize = '0.9rem';
            } else {
                card.style.fontSize = '';
            }
        });
    };
    
    window.addEventListener('resize', handleResize);
    handleResize(); // Initial call
});
</script>

{{ block.super }}
{% endblock %}